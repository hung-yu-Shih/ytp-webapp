<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>AI 台北行旅工具</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="app">

    <!-- Header -->
    <div class="header">
        <h1>行程專案</h1>
        <button id="settingsBtn" class="menu-btn">☰</button>
    </div>

    <!-- 登入/註冊面板 -->
    <div id="authPanel" class="auth-panel">
        <h3>登入 / 註冊</h3>
        <input type="text" id="usernameInput" placeholder="輸入帳號">
        <input type="password" id="passwordInput" placeholder="輸入密碼">
        <button onclick="login()">登入</button>
        <button onclick="register()">註冊</button>
        <p id="authMsg" class="auth-msg"></p>
    </div>

    <!-- 專案列表 -->
    <div id="projectList" class="project-list" style="display:none;"></div>

    <!-- 浮動新增按鈕 -->
    <button class="fab" onclick="createProject()" style="display:none;">＋</button>

</div>

<!-- 遮罩 -->
<div id="overlay" class="overlay"></div>

<!-- 右側滑出設定 -->
<div id="settingsPanel" class="settings-panel">
    <h3>設定</h3>

    <label class="switch-row">
        <span>暗色模式</span>
        <input type="checkbox" id="darkModeToggle">
    </label>
    <button id="logoutBtn" style="margin-top:20px;">登出</button>
</div>

<script>

/* ======================
   模擬後端帳號（localStorage）
====================== */

let currentUser = localStorage.getItem("currentUser") || null;
const authPanel = document.getElementById("authPanel");
const projectListEl = document.getElementById("projectList");
const fab = document.querySelector(".fab");
const authMsg = document.getElementById("authMsg");

function saveCurrentUser() {
    localStorage.setItem("currentUser", currentUser);
}

function showAppForUser() {
    authPanel.style.display = "none";
    projectListEl.style.display = "block";
    fab.style.display = "block";
    loadUserProjects();
}

function hideApp() {
    authPanel.style.display = "block";
    projectListEl.style.display = "none";
    fab.style.display = "none";
}

if (currentUser) showAppForUser();

/* ======================
   登入 / 註冊
====================== */

function getUserKey(username) {
    return `user_${username}`;
}

function register() {
    const username = document.getElementById("usernameInput").value.trim();
    const password = document.getElementById("passwordInput").value;
    if (!username || !password) {
        authMsg.textContent = "帳號密碼不可空白";
        return;
    }
    if (localStorage.getItem(getUserKey(username))) {
        authMsg.textContent = "帳號已存在";
        return;
    }
    // 儲存帳號
    localStorage.setItem(getUserKey(username), JSON.stringify({ password }));
    authMsg.textContent = "註冊成功，請登入";
}

function login() {
    const username = document.getElementById("usernameInput").value.trim();
    const password = document.getElementById("passwordInput").value;
    const userData = localStorage.getItem(getUserKey(username));
    if (!userData) {
        authMsg.textContent = "帳號不存在";
        return;
    }
    const userObj = JSON.parse(userData);
    if (userObj.password !== password) {
        authMsg.textContent = "密碼錯誤";
        return;
    }
    currentUser = username;
    saveCurrentUser();
    authMsg.textContent = "";
    showAppForUser();
}

document.getElementById("logoutBtn").addEventListener("click", () => {
    currentUser = null;
    localStorage.removeItem("currentUser");
    hideApp();
});


/* ======================
   設定滑出控制
====================== */

const settingsBtn = document.getElementById("settingsBtn");
const settingsPanel = document.getElementById("settingsPanel");
const overlay = document.getElementById("overlay");

function openSettings() {
    settingsPanel.classList.add("open");
    overlay.classList.add("show");
}

function closeSettings() {
    settingsPanel.classList.remove("open");
    overlay.classList.remove("show");
}

settingsBtn.addEventListener("click", () => {
    if (settingsPanel.classList.contains("open")) {
        closeSettings();
    } else {
        openSettings();
    }
});

overlay.addEventListener("click", closeSettings);


/* ======================
   暗色模式
====================== */

const toggle = document.getElementById("darkModeToggle");

if (localStorage.getItem("darkMode") === "true") {
    document.body.classList.add("dark");
    toggle.checked = true;
}

toggle.addEventListener("change", () => {
    document.body.classList.toggle("dark", toggle.checked);
    localStorage.setItem("darkMode", toggle.checked);
});


/* ======================
   專案管理（綁帳號）
====================== */

function getProjectsKey(user) {
    return `projects_${user}`;
}

let projects = [];

function loadUserProjects() {
    if (!currentUser) return;
    projects = JSON.parse(localStorage.getItem(getProjectsKey(currentUser)) || "[]");
    renderProjects();
}

function saveUserProjects() {
    if (!currentUser) return;
    localStorage.setItem(getProjectsKey(currentUser), JSON.stringify(projects));
}

function renderProjects() {
    const list = document.getElementById("projectList");
    list.innerHTML = "";

    if (projects.length === 0) {
        list.innerHTML = "<p class='empty'>尚無專案，點擊 ＋ 建立</p>";
        return;
    }

    projects.forEach((p, index) => {
        list.innerHTML += `
            <div class="project-card">
                <div class="project-title">${p.name}</div>
                <button class="delete-btn" onclick="deleteProject(${index})">刪除</button>
            </div>
        `;
    });
}

function createProject() {
    const name = prompt("輸入專案名稱");
    if (!name) return;

    projects.push({ name });
    saveUserProjects();
    renderProjects();
}

function deleteProject(index) {
    projects.splice(index, 1);
    saveUserProjects();
    renderProjects();
}

</script>
</body>
</html>
